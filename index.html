<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
  background:linear-gradient(180deg,#f4f6ff,#e9ecff);
  color:#1a1a2b;
}
main{
  max-width:900px;
  margin:auto;
  padding:28px;
}
h1{margin:0 0 16px}
select,button{
  padding:10px 14px;
  font-size:15px;
  border-radius:10px;
  border:1px solid #cfd6ff;
}
button{
  background:#5b6cff;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover{opacity:.9}

.card{
  background:white;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h2{margin:0 0 10px}
.item{margin:6px 0}
.small{opacity:.6;font-size:13px}
</style>
</head>

<body>
<main>
  <h1>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</h1>

  <label>ê²Œì„ ì¢…ë¥˜</label><br>
  <select id="mode">
    <option value="base">ê¸°ë³¸</option>
    <option value="war">ì˜ì›í•œì „ìŸ</option>
    <option value="both" selected>ê¸°ë³¸ + ì˜ì›í•œì „ìŸ</option>
  </select>

  <br><br>
  <button onclick="run()">ğŸ² ë½‘ê¸°</button>

  <div id="result"></div>
</main>

<script>
const PICK = {
  "ë„¤ë©”ì‹œìŠ¤":1,
  "ìºë¦­í„°":2,
  "ë³´ì„":2,
  "ìœ ë¬¼":3,
  "ì£¼ë¬¸":4
};

function allow(mode){
  if(mode==="base") return ["ê¸°ë³¸","ë¬»ë¹„"];
  if(mode==="war") return ["ì˜ì „","ë¬»ë¹„"];
  return ["ê¸°ë³¸","ì˜ì „","ë¬»ë¹„"];
}

function clean(v){
  return v.replace(/\uFEFF/g,"").trim(); // BOM ì œê±° + ê³µë°± ì œê±°
}

function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}

async function run(){
  const res = await fetch("data.csv");
  const text = await res.text();

  const lines = text.trim().split(/\r?\n/).slice(1);

  const rows = lines.map(l=>{
    const [c,k,n,e] = l.split(",");
    return {
      c: clean(c),
      k: clean(k),
      n: clean(n),
      e: e ? clean(e) : ""
    };
  });

  const mode = document.getElementById("mode").value;
  const ok = allow(mode);
  const out = document.getElementById("result");
  out.innerHTML = "";

  for(const cat in PICK){
    const pool = rows.filter(r => r.c === cat && ok.includes(r.k));
    if(pool.length === 0){
      out.innerHTML += `<div class="card"><b>${cat}</b><br><span class="small">ë°ì´í„° ì—†ìŒ</span></div>`;
      continue;
    }

    const pick = shuffle(pool).slice(0, PICK[cat]);

    const box = document.createElement("div");
    box.className = "card";
    box.innerHTML =
      `<h2>${cat}</h2>` +
      pick.map(p =>
        `<div class="item">${p.n} ${p.e ? `<span class="small">(ì—í…Œë¥´ ${p.e})</span>`:""}</div>`
      ).join("");
    out.appendChild(box);
  }
}
</script>
</body>
</html>
