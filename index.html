<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
  background:linear-gradient(180deg,#f4f6ff,#e9ecff);
  color:#1a1a2b;
}
main{
  max-width:960px;
  margin:auto;
  padding:28px;
}
h1{margin:0 0 16px}
select,button{
  padding:10px 14px;
  font-size:15px;
  border-radius:10px;
}
select{
  border:1px solid #cfd6ff;
}
button{
  background:#5b6cff;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover{opacity:.9}

.card{
  background:white;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
h2{margin:0 0 10px}
.item{margin:6px 0}
.small{opacity:.6;font-size:13px}
.badge{
  display:inline-block;
  background:#eee;
  color:#444;
  border-radius:6px;
  padding:2px 6px;
  margin-left:6px;
  font-size:12px;
}
</style>
</head>

<body>
<main>
  <h1>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</h1>

  <label>ê²Œì„ ì¢…ë¥˜</label><br>
  <select id="mode">
    <option value="base">ê¸°ë³¸</option>
    <option value="war">ì˜ì›í•œì „ìŸ</option>
    <option value="both" selected>ê¸°ë³¸ + ì˜ì›í•œì „ìŸ</option>
  </select>

  <br><br>
  <button onclick="run()">ğŸ² ë½‘ê¸°</button>

  <div id="result"></div>
</main>

<script>
/* ===== ê³ ì • ê·œì¹™ ===== */
const PICK = {
  "ë„¤ë©”ì‹œìŠ¤": 1,
  "ìºë¦­í„°": 2,
  "ë³´ì„": 2,
  "ìœ ë¬¼": 3,
  "ì£¼ë¬¸": 4
};

function allowKinds(mode){
  if(mode==="base") return ["ê¸°ë³¸","ë¬»ë¹„"];
  if(mode==="war")  return ["ì˜ì „","ë¬»ë¹„"];
  return ["ê¸°ë³¸","ì˜ì „","ë¬»ë¹„"];
}

/* ===== ì •ê·œí™” ìœ í‹¸ ===== */
function clean(v){
  return v ? v.replace(/\uFEFF/g,"").trim() : "";
}

function normalizeCategory(v){
  if(v.includes("ë„¤ë©”")) return "ë„¤ë©”ì‹œìŠ¤";
  if(v.includes("ìºë¦­")) return "ìºë¦­í„°";
  if(v.includes("ë³´ì„")) return "ë³´ì„";
  if(v.includes("ìœ ë¬¼")) return "ìœ ë¬¼";
  if(v.includes("ì£¼ë¬¸")) return "ì£¼ë¬¸";
  return v;
}

function normalizeKind(v){
  if(v.includes("ê¸°ë³¸")) return "ê¸°ë³¸";
  if(v.includes("ì˜"))   return "ì˜ì „";
  if(v.includes("ë¬»"))   return "ë¬»ë¹„";
  return v;
}

function shuffle(arr){
  return arr.slice().sort(()=>Math.random()-0.5);
}

/* ===== ë©”ì¸ ===== */
async function run(){
  const res = await fetch("data.csv");
  const text = await res.text();

  // í—¤ë” ì œê±°
  const lines = text.trim().split(/\r?\n/).slice(1);

  const rows = lines.map(line=>{
    // â­ íƒ­ / ì‰¼í‘œ ëª¨ë‘ ì²˜ë¦¬
    const parts = line.split(/\t|,/);
    const [c,k,n,e] = parts;
    return {
      category: normalizeCategory(clean(c)),
      kind: normalizeKind(clean(k)),
      name: clean(n),
      ether: clean(e)
    };
  });

  const mode = document.getElementById("mode").value;
  const allowed = allowKinds(mode);
  const out = document.getElementById("result");
  out.innerHTML = "";

  for(const cat in PICK){
    const pool = rows.filter(r =>
      r.category === cat && allowed.includes(r.kind)
    );

    if(pool.length === 0){
      out.innerHTML += `
        <div class="card">
          <h2>${cat}</h2>
          <div class="small">ë°ì´í„° ì—†ìŒ</div>
        </div>`;
      continue;
    }

    const picked = shuffle(pool).slice(0, PICK[cat]);

    const box = document.createElement("div");
    box.className = "card";
    box.innerHTML = `<h2>${cat}</h2>` +
      picked.map(p =>
        `<div class="item">
          ${p.name}
          ${p.ether ? `<span class="small">(ì—í…Œë¥´ ${p.ether})</span>` : ""}
          ${p.kind==="ë¬»ë¹„" ? `<span class="badge">ë¬»ë¹„</span>` : ""}
        </div>`
      ).join("");

    out.appendChild(box);
  }
}
</script>
</body>
</html>
