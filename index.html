<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</title>

<style>
:root{
  --bg:#0e1024;

  /* ë°ì€ ë°•ìŠ¤ */
  --box:#f5f7ff;          /* í–‰ ì „ì²´ ë°•ìŠ¤ ë°°ê²½ */
  --box2:#ffffff;         /* pill ë°°ê²½ */
  --border:#c7cff7;

  /* í…ìŠ¤íŠ¸(ì–´ë‘¡ê²Œ) */
  --text:#1a1d33;
  --muted:#5f6698;

  /* í¬ì¸íŠ¸ */
  --accent:#5c66ff;
}

/* ===== ë°°ê²½ì€ ë‹¤í¬ ìœ ì§€ ===== */
body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
  background:
    radial-gradient(1200px 500px at 50% -10%, #2b2f5a 0%, transparent 60%),
    linear-gradient(180deg, #0e1024 0%, #15183a 100%);
  color:var(--text);
}

main{
  max-width:900px;
  margin:0 auto;
  padding:26px;
}

h1{
  text-align:center;
  margin:10px 0 20px;
  letter-spacing:4px;
  font-size:34px;
  color:#eef1ff;
}

/* ===== ìƒë‹¨ ì»¨íŠ¸ë¡¤ ===== */
.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
}

select,button,input{
  padding:8px 12px;
  font-size:14px;
  border-radius:10px;
}

select,input{
  border:1px solid rgba(180,190,255,.35);
  background:#0f1230;
  color:#eef1ff;
}

button{
  border:0;
  background:linear-gradient(180deg,#8f9bff,#5c66ff);
  color:white;
  font-weight:800;
  cursor:pointer;
  box-shadow:
    0 6px 18px rgba(90,100,255,.35),
    inset 0 1px 0 rgba(255,255,255,.25);
}

button.secondary{
  background:#0f1230;
  border:1px solid rgba(180,190,255,.35);
  box-shadow:none;
  color:#eef1ff;
}

button:hover{opacity:.92}

.hint{
  text-align:center;
  margin-top:10px;
  font-size:12px;
  color:#aeb4ff;
}

#msg{
  text-align:center;
  margin-top:12px;
  font-size:13px;
  color:#cfd4ff;
}

/* =========================================================
   ===== í‘œ(Table) UI â€“ í–‰ ì „ì²´ê°€ ë°ì€ ë°•ìŠ¤ =====
   ========================================================= */

.table{
  margin-top:18px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* âœ… í–‰ ì „ì²´(ë„¤ë©”ì‹œìŠ¤ í•œ ì¤„)ê°€ ë°ì€ ë°•ìŠ¤ */
.rowItem{
  display:grid;
  grid-template-columns:120px 1fr;
  gap:14px;
  padding:14px;
  border:1px solid var(--border);
  border-radius:16px;
  background:var(--box);
  box-shadow:0 10px 24px rgba(0,0,0,.20);
}

.rowItem:hover{
  box-shadow:0 14px 30px rgba(0,0,0,.26);
  transform:translateY(-1px);
}

/* ì™¼ìª½ ë¼ë²¨ë„ ë°ì€ ë°•ìŠ¤ ì•ˆì—ì„œ ë” êµ¬ë¶„ë˜ê²Œ */
.rowTitle{
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-weight:900;
  letter-spacing:.8px;
  font-size:14px;
  color:var(--text);

  background:linear-gradient(180deg, #ffffff, #eef1ff);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px 6px;
}

/* ì¹´í…Œê³ ë¦¬ë³„ ë¼ë²¨ í¬ì¸íŠ¸(ë„ˆë¬´ íŠ€ì§€ ì•Šê²Œ) */
.rowItem[data-cat="ë„¤ë©”ì‹œìŠ¤"] .rowTitle{ box-shadow: inset 0 0 0 2px rgba(255,120,120,.25); }
.rowItem[data-cat="ìºë¦­í„°"]   .rowTitle{ box-shadow: inset 0 0 0 2px rgba(120,255,200,.22); }
.rowItem[data-cat="ë³´ì„"]     .rowTitle{ box-shadow: inset 0 0 0 2px rgba(120,170,255,.25); }
.rowItem[data-cat="ìœ ë¬¼"]     .rowTitle{ box-shadow: inset 0 0 0 2px rgba(255,210,120,.25); }
.rowItem[data-cat="ì£¼ë¬¸"]     .rowTitle{ box-shadow: inset 0 0 0 2px rgba(180,120,255,.25); }

/* ì˜¤ë¥¸ìª½ ë‚´ìš©ì€ ê·¸ëƒ¥ ì¹©ë“¤ì´ ì˜ ë³´ì´ê²Œ */
.rowContent{
  display:flex;
  flex-wrap:wrap;
  gap:8px 10px;
  align-items:flex-start;
}

/* pill(ì¹©) */
.pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:7px 11px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--box2);
  color:var(--text);
  font-size:13px;
  white-space:nowrap;

  box-shadow:
    0 1px 2px rgba(0,0,0,.08),
    inset 0 1px 0 rgba(255,255,255,.75);
}

/* ì—í…Œë¥´ */
.pill .ether{
  font-weight:900;
  color:#2c36b5;
  letter-spacing:.2px;
}

/* ë¬»ë¹„ */
.pill.mutbi{
  background:#eef1ff;
  border-color:#6f7cff;
  box-shadow:
    0 0 0 1px rgba(110,125,255,.25) inset,
    0 2px 6px rgba(90,100,255,.20);
}

.pill .tag{
  font-size:11px;
  color:#4a55c9;
  font-weight:700;
}

/* ===== ì„¤ì • ëª¨ë‹¬ (ë‹¤í¬ ìœ ì§€) ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal.open{display:flex}

.modalBox{
  width:360px;
  background:#12153a;
  border:1px solid rgba(180,190,255,.35);
  border-radius:16px;
  padding:18px;
  box-shadow:0 25px 60px rgba(0,0,0,.45);
  color:#eef1ff;
}

.modalBox h2{
  margin:0 0 8px;
  text-align:center;
}

.modalRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:14px 0;
}

.modalActions{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-top:16px;
}
</style>

</head>

<body>
<main>
  <h1>AEONâ€™S END</h1>

  <div class="row">
    <label>ê²Œì„ ì¢…ë¥˜</label>
    <select id="mode">
      <option value="base">ê¸°ë³¸</option>
      <option value="war">ì˜ì›í•œì „ìŸ</option>
      <option value="both" selected>ê¸°ë³¸ + ì˜ì›í•œì „ìŸ</option>
      <option value="random">ëœë¤</option>
    </select>
    <button id="roll">ğŸ² ë½‘ê¸°</button>
    <button id="openSettings" class="secondary">âš™ ì„¤ì •</button>
  </div>

  <div class="hint">
    ë¬»ë¹„ëŠ” í•­ìƒ í¬í•¨ Â· ì¤‘ë³µ ì—†ì´ ë½‘ê¸° Â· ì—í…Œë¥´ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
  </div>

  <div id="msg"></div>
  <div id="result" class="table"></div>
</main>

<!-- ===== ì„¤ì • ëª¨ë‹¬ ===== -->
<div id="settingsModal" class="modal">
  <div class="modalBox">
    <h2>ì¹´ë“œ ê°œìˆ˜ ì„¤ì •</h2>
    <div class="modalRow">
      <span>ë³´ì„</span><input id="set-gem" type="number" min="0">
    </div>
    <div class="modalRow">
      <span>ìœ ë¬¼</span><input id="set-relic" type="number" min="0">
    </div>
    <div class="modalRow">
      <span>ì£¼ë¬¸</span><input id="set-spell" type="number" min="0">
    </div>
    <div class="modalActions">
      <button id="resetSettings" class="secondary">ì´ˆê¸°í™”</button>
      <button id="saveSettings">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
/* ===== ê¸°ë³¸ ì„¸íŒ… (ì‹¤ì œ ì €ì¥) ===== */
const DEFAULTS={gem:2,relic:3,spell:4};
function ensureDefaults(){
  if(localStorage.getItem("pick_gem")==null) localStorage.setItem("pick_gem",DEFAULTS.gem);
  if(localStorage.getItem("pick_relic")==null) localStorage.setItem("pick_relic",DEFAULTS.relic);
  if(localStorage.getItem("pick_spell")==null) localStorage.setItem("pick_spell",DEFAULTS.spell);
}
ensureDefaults();

const getNum=(k,d)=>Number(localStorage.getItem(k))||d;

/* ===== ëª¨ë“œ ===== */
function allowedKinds(mode){
  if(mode==="base") return new Set(["ê¸°ë³¸","ë¬»ë¹„"]);
  if(mode==="war") return new Set(["ì˜ì „","ë¬»ë¹„"]);
  return new Set(["ê¸°ë³¸","ì˜ì „","ë¬»ë¹„"]);
}

/* ===== CSV ===== */
const clean=v=>(v??"").trim();
const normCat=v=>v.includes("ë„¤ë©”")?"ë„¤ë©”ì‹œìŠ¤":v.includes("ìºë¦­")?"ìºë¦­í„°":v.includes("ë³´ì„")?"ë³´ì„":v.includes("ìœ ë¬¼")?"ìœ ë¬¼":v.includes("ì£¼ë¬¸")?"ì£¼ë¬¸":v;
const normKind=v=>v.includes("ê¸°ë³¸")?"ê¸°ë³¸":v.includes("ì˜")?"ì˜ì „":v.includes("ë¬»")?"ë¬»ë¹„":v;

async function loadData(){
  const r=await fetch("data.csv",{cache:"no-store"});
  const t=await r.text();
  return t.split(/\r?\n/).filter(Boolean).map(l=>{
    const p=l.split(",");
    return {category:normCat(clean(p[0])),kind:normKind(clean(p[1])),name:clean(p[2]),ether:clean(p[3])};
  });
}

/* ===== ìœ í‹¸ ===== */
const etherVal=i=>Number(String(i.ether??"").replace(/[^\d]/g,""))||Infinity;
const shuffle=a=>a.slice().sort(()=>Math.random()-0.5);

/* ===== ë Œë” (í‘œ) ===== */
function render(result){
  const box = document.getElementById("result");
  box.innerHTML = "";
  box.className = "table";

  const order = ["ë„¤ë©”ì‹œìŠ¤","ìºë¦­í„°","ë³´ì„","ìœ ë¬¼","ì£¼ë¬¸"];

  for(const cat of order){
    const row = document.createElement("div");
    row.className = "rowItem";
    row.dataset.cat = cat; // âœ… ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒìš©

    const t = document.createElement("div");
    t.className = "rowTitle";
    t.textContent = cat;

    const c = document.createElement("div");
    c.className = "rowContent";

    for(const it of (result[cat] || [])){
      const etherNum = Number(String(it.ether ?? "").replace(/[^\d]/g,"")) || 0;
      const pill = document.createElement("span");
      pill.className = "pill" + (it.kind === "ë¬»ë¹„" ? " mutbi" : "");

      const nameText = it.name;

      // âœ… ì›í•˜ëŠ” í‘œê¸°: 6â™ª ì¹´ë“œì´ë¦„
      pill.innerHTML = etherNum
        ? `<span class="ether">${etherNum}â™ª</span><span>${nameText}</span>${it.kind==="ë¬»ë¹„" ? `<span class="tag">ë¬»ë¹„</span>` : ``}`
        : `<span>${nameText}</span>${it.kind==="ë¬»ë¹„" ? `<span class="tag">ë¬»ë¹„</span>` : ``}`;

      c.appendChild(pill);
    }

    row.append(t, c);
    box.appendChild(row);
  }
}


/* ===== ë©”ì¸ ===== */
async function roll(){
  let mode=document.getElementById("mode").value;
  if(mode==="random") mode=["base","war","both"][Math.floor(Math.random()*3)];

  document.getElementById("msg").innerHTML=`ì´ë²ˆ íŒ ëª¨ë“œ: <b>${mode==="base"?"ê¸°ë³¸":mode==="war"?"ì˜ì›í•œì „ìŸ":"ê¸°ë³¸ + ì˜ì›í•œì „ìŸ"}</b>`;

  const rows=await loadData();
  const allowed=allowedKinds(mode);
  const pick={
    ë„¤ë©”ì‹œìŠ¤:1,
    ìºë¦­í„°:2,
    ë³´ì„:getNum("pick_gem",2),
    ìœ ë¬¼:getNum("pick_relic",3),
    ì£¼ë¬¸:getNum("pick_spell",4)
  };

  const byCat={};
  for(const r of rows){
    if(!(r.category in pick)) continue;
    if(!allowed.has(r.kind)) continue;
    (byCat[r.category] ||= []).push(r);
  }

  const result={};
  for(const c in pick){
    result[c]=shuffle(byCat[c]||[]).slice(0,pick[c]).sort((a,b)=>etherVal(a)-etherVal(b));
  }

  render(result);
}

/* ===== ì„¤ì • ëª¨ë‹¬ ===== */
const modal=document.getElementById("settingsModal");
const setGem=document.getElementById("set-gem");
const setRelic=document.getElementById("set-relic");
const setSpell=document.getElementById("set-spell");

openSettings.onclick=()=>{
  modal.classList.add("open");
  setGem.value=getNum("pick_gem",2);
  setRelic.value=getNum("pick_relic",3);
  setSpell.value=getNum("pick_spell",4);
};
modal.onclick=e=>{if(e.target===modal) modal.classList.remove("open")};

saveSettings.onclick=()=>{
  localStorage.setItem("pick_gem",setGem.value);
  localStorage.setItem("pick_relic",setRelic.value);
  localStorage.setItem("pick_spell",setSpell.value);
  modal.classList.remove("open");
  roll();
};
resetSettings.onclick=()=>{
  localStorage.setItem("pick_gem",2);
  localStorage.setItem("pick_relic",3);
  localStorage.setItem("pick_spell",4);
  modal.classList.remove("open");
  roll();
};

roll.onclick=roll;
roll();
</script>
</body>
</html>
