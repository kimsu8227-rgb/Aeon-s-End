<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—ì´ì–¸ì¦ˆ ì—”ë“œ ëœë”ë§ˆì´ì €</title>

<style>
:root{
  /* ë°ì€ ë°°ê²½ */
  --bg1:#f3f6ff;
  --bg2:#eef2ff;
  --bg3:#f7f5ff;

  /* ë°•ìŠ¤ */
  --box:#ffffff;
  --border:#cfd7ff;

  /* í…ìŠ¤íŠ¸ */
  --text:#101325;   /* âœ… ë” ì§„í•˜ê²Œ */
  --muted:#4b5283;  /* âœ… ì„¤ëª…ë„ ì¢€ ë” ì§„í•˜ê²Œ */

  --accent:#5c66ff;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;

  /* ğŸ¤ í° ë°°ê²½ + ì–‡ì€ ë‚¨ìƒ‰ ì„¸ë¡œ ìŠ¤íŠ¸ë¼ì´í”„ */
  background:
    repeating-linear-gradient(
      90deg,
      rgba(40,55,120,.08) 0px,   /* ë‚¨ìƒ‰ ìŠ¤íŠ¸ë¼ì´í”„ */
      rgba(40,55,120,.08) 2px,
      rgba(255,255,255,1) 2px,
      rgba(255,255,255,1) 14px
    );

  color:var(--text);
}


main{
  max-width:920px;
  margin:0 auto;
  padding:28px;
}

/* ì œëª©ê³¼ ê²°ê³¼ê°€ ê°™ì€ ê¸°ì¤€ì„ ìœ¼ë¡œ ì •ë ¬ë˜ê²Œ */
h1{
  margin:6px 0 18px;
  font-size:36px;
  letter-spacing:3px;
  text-align:center;
  color:#15183a;
}

/* ===== ìƒë‹¨ ì»¨íŠ¸ë¡¤ ===== */
.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
}

select,button,input{
  padding:10px 14px;
  font-size:15px;
  border-radius:12px;
}

select,input{
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--text);
}

button{
  border:0;
  background:linear-gradient(180deg,#7f8bff,#5c66ff);
  color:white;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 8px 18px rgba(92,102,255,.20);
}

button.secondary{
  background:#ffffff;
  border:1px solid var(--border);
  color:var(--text);
  box-shadow:none;
}

button:hover{opacity:.92}

.hint{
  text-align:center;
  margin-top:12px;
  font-size:14px;
  color:var(--muted);
}

#msg{
  text-align:center;
  margin-top:14px;
  font-size:15px;
  color:#2b2f5a;
}

/* =================================================
   ===== í‘œ UI â€“ ê°€ë…ì„± ìµœìš°ì„  + ì¤‘ì•™ ì •ë ¬ ëŠë‚Œ =====
   ================================================= */
.table{
  margin-top:22px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* í–‰ ì „ì²´ ë°•ìŠ¤ */
/* ===== í–‰ ì „ì²´ ë°•ìŠ¤ ===== */
.rowItem{
  display:grid;
  grid-template-columns:130px 1fr;
  gap:16px;
  padding:16px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}

/* === ì¹´í…Œê³ ë¦¬ë³„ í–‰ ì „ì²´ ë°°ê²½ìƒ‰ === */
.rowItem[data-cat="ë„¤ë©”ì‹œìŠ¤"]{
  background:#fff1f1;   /* ì—°í•‘í¬ */
  border-color:#ffd0d0;
}

.rowItem[data-cat="ìºë¦­í„°"]{
  background:#f0fff6;   /* ì—°ë¯¼íŠ¸ */
  border-color:#c9f3d8;
}

.rowItem[data-cat="ë³´ì„"]{
  background:#f4efff;   /* ì—°ë³´ë¼ */
  border-color:#dacbff;
}

.rowItem[data-cat="ìœ ë¬¼"]{
  background:#eef6ff;   /* ì—°íŒŒë‘ */
  border-color:#c6dcff;
}

.rowItem[data-cat="ì£¼ë¬¸"]{
  background:#fff9e6;   /* ì—°ë…¸ë‘ */
  border-color:#f0dc8a;
}


/* ì™¼ìª½ ì¹´í…Œê³ ë¦¬(ì œëª© ë°•ìŠ¤) */
.rowTitle{
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-weight:900;
  letter-spacing:1px;
  font-size:18px;
  color:var(--text);

  border:1px solid var(--border);
  border-radius:14px;
  padding:14px 8px;

  /* ê¸°ë³¸ì€ ì€ì€í•œ íšŒë³´ë¼ */
  background:linear-gradient(180deg,#fbfbff,#f2f4ff);
}

/* âœ… ì¹´í…Œê³ ë¦¬ë³„ ì—°í•œ ìƒ‰ì¹  (ë„ˆë¬´ ì§„í•˜ì§€ ì•Šê²Œ) */
.rowItem[data-cat="ë³´ì„"] .rowTitle{
  background:linear-gradient(180deg,#f6f0ff,#efe6ff); /* ì—°ë³´ë¼ */
  border-color:#dacbff;
}
.rowItem[data-cat="ìœ ë¬¼"] .rowTitle{
  background:linear-gradient(180deg,#eef6ff,#e3efff); /* ì—°íŒŒë‘ */
  border-color:#c6dcff;
}
.rowItem[data-cat="ì£¼ë¬¸"] .rowTitle{
  background:linear-gradient(180deg,#fff8dc,#fff1b8); /* ì—°ë…¸ë‘ */
  border-color:#f0dc8a;
}

/* ë„¤ë©”ì‹œìŠ¤/ìºë¦­í„°ëŠ” ì€ì€í•˜ê²Œ */
.rowItem[data-cat="ë„¤ë©”ì‹œìŠ¤"] .rowTitle{
  background:linear-gradient(180deg,#fff1f1,#ffe7e7);
  border-color:#ffd0d0;
}
.rowItem[data-cat="ìºë¦­í„°"] .rowTitle{
  background:linear-gradient(180deg,#f0fff6,#e7ffef);
  border-color:#c9f3d8;
}

/* ì˜¤ë¥¸ìª½ ë‚´ìš© */
.rowContent{
  display:flex;
  flex-wrap:wrap;
    gap:10px 12px;    /* ì¤„/ê°€ë¡œ ê°„ê²© ê· í˜• */
  align-items:flex-start;
}

/* ì¹´ë“œ í•­ëª© pill */
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--text);
  font-size:16px;
  white-space:nowrap;
   font-weight:650;         /* âœ… ì²´ê° í¼ (500~700 ì‚¬ì´) */
  letter-spacing:-0.1px;   /* âœ… í•œê¸€ ê°€ë…ì„±ì— ë„ì›€ */
  box-shadow:0 2px 6px rgba(25,35,80,.10); /* ì‚´ì§ ë” */
}

/* ì—í…Œë¥´ */
.pill .ether{
  font-weight:900;
  color:#1f2aa8;
  background:#eef1ff;      /* âœ… ì‘ì€ ë°°ê²½ */
  border:1px solid #d7dcff;
  padding:2px 8px;
  border-radius:999px;
}

/* ë¬»ë¹„ ê°•ì¡°ëŠ” ì—†ìŒ(ìš”ì²­ëŒ€ë¡œ) */

/* ===== ì„¤ì • ëª¨ë‹¬ ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal.open{display:flex}

.modalBox{
  width:360px;
  background:#ffffff;
  border:1px solid var(--border);
  border-radius:18px;
  padding:20px;
  box-shadow:0 30px 70px rgba(25,35,80,.25);
  color:var(--text);
}

.modalBox h2{
  margin:0 0 10px;
  text-align:center;
}

.modalRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:16px 0;
}

.modalActions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top:18px;
}
  .hint.bottom{
  margin-top:28px;
  padding-top:14px;
  border-top:1px dashed #d7dcff;
  text-align:center;
  font-size:13px;
  color:#6b70a5;
}
</style>

</head>

<body>
<main>
  <h1>AEONâ€™S END</h1>

  <div class="row">
    <label>ê²Œì„ ì¢…ë¥˜</label>
    <select id="mode">
      <option value="base">ê¸°ë³¸</option>
      <option value="war">ì˜ì›í•œì „ìŸ</option>
      <option value="both" selected>ê¸°ë³¸ + ì˜ì›í•œì „ìŸ</option>
      <option value="random">ëœë¤</option>
    </select>
    <button id="roll">ğŸ² ë½‘ê¸°</button>
    <button id="openSettings" class="secondary">âš™ ì„¤ì •</button>
  </div>

  

  <div id="msg"></div>
  <div id="result" class="table"></div>
  <div class="footer-controls">
  <button id="openSettings" class="secondary">âš™ ì„¤ì •</button>
</div>
  <div class="hint bottom">
  ë¬»ë¹„ëŠ” í•­ìƒ í¬í•¨ Â· ì¤‘ë³µ ì—†ì´ ë½‘ê¸° Â· ì—í…Œë¥´ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
</div>
</main>

<!-- ===== ì„¤ì • ëª¨ë‹¬ ===== -->
<div id="settingsModal" class="modal">
  <div class="modalBox">
    <h2>ì¹´ë“œ ê°œìˆ˜ ì„¤ì •</h2>
    <div class="modalRow">
      <span>ë³´ì„</span><input id="set-gem" type="number" min="0">
    </div>
    <div class="modalRow">
      <span>ìœ ë¬¼</span><input id="set-relic" type="number" min="0">
    </div>
    <div class="modalRow">
      <span>ì£¼ë¬¸</span><input id="set-spell" type="number" min="0">
    </div>
    <div class="modalActions">
      <button id="resetSettings" class="secondary">ì´ˆê¸°í™”</button>
      <button id="saveSettings">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
/* ===== ê¸°ë³¸ ì„¸íŒ… (ì‹¤ì œ ì €ì¥) ===== */
const DEFAULTS={gem:2,relic:3,spell:4};
function ensureDefaults(){
  if(localStorage.getItem("pick_gem")==null) localStorage.setItem("pick_gem",DEFAULTS.gem);
  if(localStorage.getItem("pick_relic")==null) localStorage.setItem("pick_relic",DEFAULTS.relic);
  if(localStorage.getItem("pick_spell")==null) localStorage.setItem("pick_spell",DEFAULTS.spell);
}
ensureDefaults();

const getNum=(k,d)=>Number(localStorage.getItem(k))||d;

/* ===== ëª¨ë“œ ===== */
function allowedKinds(mode){
  if(mode==="base") return new Set(["ê¸°ë³¸","ë¬»ë¹„"]);
  if(mode==="war") return new Set(["ì˜ì „","ë¬»ë¹„"]);
  return new Set(["ê¸°ë³¸","ì˜ì „","ë¬»ë¹„"]);
}

/* ===== CSV ===== */
const clean=v=>(v??"").trim();
const normCat=v=>v.includes("ë„¤ë©”")?"ë„¤ë©”ì‹œìŠ¤":v.includes("ìºë¦­")?"ìºë¦­í„°":v.includes("ë³´ì„")?"ë³´ì„":v.includes("ìœ ë¬¼")?"ìœ ë¬¼":v.includes("ì£¼ë¬¸")?"ì£¼ë¬¸":v;
const normKind=v=>v.includes("ê¸°ë³¸")?"ê¸°ë³¸":v.includes("ì˜")?"ì˜ì „":v.includes("ë¬»")?"ë¬»ë¹„":v;

async function loadData(){
  const r=await fetch("data.csv",{cache:"no-store"});
  const t=await r.text();
  return t.split(/\r?\n/).filter(Boolean).map(l=>{
    const p=l.split(",");
    return {category:normCat(clean(p[0])),kind:normKind(clean(p[1])),name:clean(p[2]),ether:clean(p[3])};
  });
}

/* ===== ìœ í‹¸ ===== */
const etherVal=i=>Number(String(i.ether??"").replace(/[^\d]/g,""))||Infinity;
const shuffle=a=>a.slice().sort(()=>Math.random()-0.5);

/* ===== ë Œë” (í‘œ) ===== */
function render(result){
  const box = document.getElementById("result");
  box.innerHTML = "";
  box.className = "table";

  const order = ["ë„¤ë©”ì‹œìŠ¤","ìºë¦­í„°","ë³´ì„","ìœ ë¬¼","ì£¼ë¬¸"];

  for(const cat of order){
    const row = document.createElement("div");
    row.className = "rowItem";
    row.dataset.cat = cat; // âœ… ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒìš©

    const t = document.createElement("div");
    t.className = "rowTitle";
    t.textContent = cat;

    const c = document.createElement("div");
    c.className = "rowContent";

    for(const it of (result[cat] || [])){
      const etherNum = Number(String(it.ether ?? "").replace(/[^\d]/g,"")) || 0;
      const pill = document.createElement("span");
      pill.className = "pill" + (it.kind === "ë¬»ë¹„" ? " mutbi" : "");

      const nameText = it.name;

      // âœ… ì›í•˜ëŠ” í‘œê¸°: 6â™ª ì¹´ë“œì´ë¦„
      pill.innerHTML = etherNum
        ? `<span class="ether">${etherNum}â™ª</span><span>${nameText}</span>${it.kind==="ë¬»ë¹„" ? `<span class="tag">ë¬»ë¹„</span>` : ``}`
        : `<span>${nameText}</span>${it.kind==="ë¬»ë¹„" ? `<span class="tag">ë¬»ë¹„</span>` : ``}`;

      c.appendChild(pill);
    }

    row.append(t, c);
    box.appendChild(row);
  }
}


/* ===== ë©”ì¸ ===== */
/* ===== ë©”ì¸ ===== */
async function doRoll(){
  let mode = document.getElementById("mode").value;
  if(mode === "random") mode = ["base","war","both"][Math.floor(Math.random()*3)];

  document.getElementById("msg").innerHTML =
    `ì´ë²ˆ íŒ ëª¨ë“œ: <b>${mode==="base"?"ê¸°ë³¸":mode==="war"?"ì˜ì›í•œì „ìŸ":"ê¸°ë³¸ + ì˜ì›í•œì „ìŸ"}</b>`;

  const rows = await loadData();
  const allowed = allowedKinds(mode);
  const pick = {
    ë„¤ë©”ì‹œìŠ¤: 1,
    ìºë¦­í„°: 2,
    ë³´ì„: getNum("pick_gem", 2),
    ìœ ë¬¼: getNum("pick_relic", 3),
    ì£¼ë¬¸: getNum("pick_spell", 4)
  };

  const byCat = {};
  for(const r of rows){
    if(!(r.category in pick)) continue;
    if(!allowed.has(r.kind)) continue;
    (byCat[r.category] ||= []).push(r);
  }

  const result = {};
  for(const c in pick){
    result[c] = shuffle(byCat[c] || [])
      .slice(0, pick[c])
      .sort((a,b)=>etherVal(a)-etherVal(b));
  }

  render(result);
}

/* ===== ì„¤ì • ëª¨ë‹¬ ===== */
const modal = document.getElementById("settingsModal");
const setGem = document.getElementById("set-gem");
const setRelic = document.getElementById("set-relic");
const setSpell = document.getElementById("set-spell");

const openSettingsBtn = document.getElementById("openSettings");
const saveSettingsBtn = document.getElementById("saveSettings");
const resetSettingsBtn = document.getElementById("resetSettings");
const rollBtn = document.getElementById("roll");

openSettingsBtn.addEventListener("click", () => {
  modal.classList.add("open");
  setGem.value = getNum("pick_gem", 2);
  setRelic.value = getNum("pick_relic", 3);
  setSpell.value = getNum("pick_spell", 4);
});

modal.addEventListener("click", (e) => {
  if(e.target === modal) modal.classList.remove("open");
});

saveSettingsBtn.addEventListener("click", () => {
  localStorage.setItem("pick_gem", String(Math.max(0, Number(setGem.value || 0))));
  localStorage.setItem("pick_relic", String(Math.max(0, Number(setRelic.value || 0))));
  localStorage.setItem("pick_spell", String(Math.max(0, Number(setSpell.value || 0))));
  modal.classList.remove("open");
  doRoll();
});

resetSettingsBtn.addEventListener("click", () => {
  localStorage.setItem("pick_gem", "2");
  localStorage.setItem("pick_relic", "3");
  localStorage.setItem("pick_spell", "4");
  modal.classList.remove("open");
  doRoll();
});

rollBtn.addEventListener("click", doRoll);

/* ì²« ë¡œë”© */
doRoll();

</script>
</body>
</html>
